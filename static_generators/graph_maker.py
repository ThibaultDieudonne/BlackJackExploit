import pickle
import inspect
import os
filepath = os.path.realpath(
            os.path.abspath(
                os.path.split(
                    inspect.getfile(
                        inspect.currentframe()))[0]))
                        
class Graph():
    def __init__(self, card):
        self.hands = [[]for _ in range(6)]
        self.ans = [[]for _ in range(6)]
        self.card = card
        self.dcard = [0 for _ in range(10)]
        self.dcard[card] += 1
        
    def construct(self):
        self.construct_rec(self.dcard)
        return self.ans
        
    def construct_rec(self, dhand):
        shand = [_ for _ in dhand]
        shand[self.card] -= 1
        sco = score(dhand)
        if sco > 16 or not sco:
            lhand = sum(shand) - 1
            if sco == 0:
                pindex = 5
            elif sco < 22:
                pindex = sco - 17
            else:
                return None
            self.addempty(pindex, lhand)
            try:
                index = self.hands[pindex][lhand].index(shand)
                self.ans[pindex][lhand][index][-1] += 1
            except:
                self.hands[pindex][lhand].append(shand)
                tmphand = [[i, j] for i, j in enumerate(shand)] 
                self.ans[pindex][lhand].append(tmphand + [1])
        else:
            for value in range(10):
                nhand = [_ for _ in dhand] 
                nhand[value] += 1
                self.construct_rec(nhand)
        return None
        
    def addempty(self, index, lhand):
        while len(self.hands[index]) < lhand + 2:
            self.hands[index].append([])
            self.ans[index].append([])
                
def score(cards):
    nbAces = cards[0]
    toreturn = sum([count + card * count for card, count in enumerate(cards)])
    if cards == [1, 0, 0, 0, 0, 0, 0, 0, 0, 1]:
        return 0
    return toreturn + 10 if (nbAces and toreturn < 12) else toreturn

Graphs = [Graph(i)for i in range(10)]
GRAPHS = [g.construct() for g in Graphs]
with open(os.path.join(filepath, 'GRAPHS'), 'wb') as fp:
    pickle.dump(GRAPHS, fp)