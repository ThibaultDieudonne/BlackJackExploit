import os
import sys
import importlib
import inspect

_filepath = os.path.realpath(
            os.path.abspath(
                os.path.split(
                    inspect.getfile(
                        inspect.currentframe()))[0]))
sys.path.append(_filepath)
importlib.import_module('blackjack')
from blackjack import *

if __name__ == '__main__':
    _timer = Timer()
    _timer.is_daemon = True
    _timer.start()
    _deck = [32, 32, 32, 32, 32, 32, 32, 32, 32, 128]
    record = 0.
    hands = []
    probs = []
    s = float(sum(_deck))
    for c1 in range(10):
        p1 = _deck[c1]
        for c2 in range(10):
            if c1 == c2:
                p2 = p1 - 1
            else:
                p2 = _deck[c2]
            probs.append(p1 * p2)
            hands.append([c1, c2])
    for index in range(len(hands)):
        calc = FastEval(hands[index], _deck, False, 4)
        tmpev = calc.ev(calc.cards, calc.deck, evd(score(calc.cards), calc.ddib, 0))
        print("EV for {} = {}\n".format(hands[index], tmpev))
        record += tmpev * probs[index]
        _timer.done += 1
    _timer.hastorun = False
    cls()
    print("Every case evaluated in {}s\nGlobal EV = {}%".format(_timer.count, round(100 * record / (s * (s - 1)), 6)))
    sys.exit()
